# 多核软件设计 Problem 1.6报告
罗宇成，202021045751

## 问题描述
map是C++ STL中常用的数据结构。本实验对身份证号查询相应的个人信息的问题进行探索，其中身份证号为Key，相应的人为Value，以map为基本数据结构设计了四种不同的方案，并在不同的数据规模对性能进行了测试。

## 实验环境
| CPU: | Intel(R) Xeon(R) CPU E5-2630 v3 @ 2.40GHz   |
| ------------- | ------------- |
| 内存: | 128GiB  |
| 操作系统: | Ubuntu 20.04.1  |
| 编译器: | gcc 9.3.0-17ubuntu1~20.04  |
| 编译参数: | g++ -O2 -s -DNDEBUG  |

## 实验方法

对数据采用N = 1e6, 1e7, 1e8的插入数据规模，查询数据规模统一为M = 1e6. 对不同数据统计插入时间和查询时间（单位为s)，以及每秒插入数据数量和每秒查询数据数量。

* 方案1 基础方案，直接使用map。
* 方案2 将信息转为存储数组下标。
* 方案3 身份证字符串ID更换为Int64作为Key
* 方案4 按照生日进行分桶


每种方案，运行5次程序统计时间取平均值。

## 实验结果

|      |   N   |  $T_i$   |   $T_s$   |   $B_i$   |   $B_s$  |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 方案1 | 1e6 | 1.13 | 1.09 | 888317.21 | 184316.17 |
| 方案1 | 1e7 | 18.98 | 1.75 | 527008.67 | 114431.01 |
| 方案1 | 1e8 | 280.32 | 2.62 | 356736.43 | 76451.02 |
| 方案2 | 1e6 | 1.08 | 1.11 | 929247.81 | 180670.76 |
| 方案2 | 1e7 | 18.03 | 1.82 | 554569.04 | 110158.97 |
| 方案2 | 1e8 | 267.35 | 2.43 | 374044.60 | 82427.46 |
| 方案3 | 1e6 | 0.64 | 0.65 | 1565150.48 | 308127.95 |
| 方案3 | 1e7 | 12.27 | 1.11 | 814934.82 | 180247.08 |
| 方案3 | 1e8 | 190.67 | 1.85 | 524454.80 | 108340.84 |
| 方案4 | 1e6 | 0.55 | 0.55 | 1810425.30 | 362127.81 |
| 方案4 | 1e7 | 11.13 | 1.06 | 898372.51 | 188726.75 |
| 方案4 | 1e8 | 171.65 | 1.64 | 582569.29 | 121747.81 |


## 讨论

### 现象
1. 实验结果显示std::map满足nlogn复杂度的特性
2. 方案1到4依次递进，都有一定的性能提升。

### 分析
1. 对比方案1和方案2，发现插入时间减少，而查询时间基本持平。主要是因为在插入的时候减少了数据拷贝的开销。
2. 对比方案2和方案3，可以发现将字符串ID改成64位整数作为Key的提升最明显。因为比较字符串和比较整数的开销相差较大。
3. 对比方案3和方案4，可以看出方案4预先分桶降低了树的高度，提升了插入和查询和性能。